<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Gaming Gaiden</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="./resources/images/favicon.ico"
    />
    <link rel="stylesheet" href="./resources/css/theme.css" />
    <link rel="stylesheet" href="./resources/css/AllGames.css" />
    <link rel="stylesheet" href="./resources/css/jquery.dataTables.css" />
    <script src="./resources/js/jquery-3.7.1.min.js"></script>
    <script src="./resources/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript">
      function formatPlaytime(minutes) {
        var hours = Math.floor(minutes / 60);
        var mins = minutes % 60;
        return hours + " Hr " + mins + " Min";
      }

      function updateTotalPlaytime() {
        var table = $("table").DataTable();
        var total = 0;

        table.rows({search:'applied'}).every(function() {
          var data = this.data();
          total += parseInt(data[3]) || 0;
        });

        var formattedTotal = formatPlaytime(total);
        $("#TotalPlaytime").html('Total Playtime\n' + formattedTotal);
      }

      $(document).ready(function () {
        $("table").each(function () {
          var tHead = $(this).find("tr:first").html();
          $(this).find("colgroup").remove();
          $(this).find("tr:first").remove();
          $(this)
            .find("tbody")
            .before("<thead>" + tHead + "</thead>");
        });

        var dataTable = $("table").DataTable({
          columnDefs: [
            {
              targets: 3,
              className: "playtimegradient",
              render: function (data, type, row, meta) {
                if (type === "display" || type === "filter") {
                  var hours = parseInt(parseInt(data) / 60);
                  var minutes = parseInt(data) % 60;
                  return hours + " Hr " + minutes + " Min";
                }
                return data;
              },
              createdCell: function (td, cellData, rowData, row, col) {
                var maxPlayTime = _MAXPLAYTIME_;
                var percentage = (
                  (parseInt(cellData) / maxPlayTime) *
                  95
                ).toFixed(2);
                $(td).css("background-size", percentage + "% 85%");
              },
            },
            {
              targets: 7,
              render: function (data, type, row, meta) {
                if (type === "display" || type === "filter") {
                  var utcSeconds = parseInt(data);
                  var date = new Date(0);
                  date.setUTCSeconds(utcSeconds);
                  return date.toLocaleDateString(undefined, {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                  });
                }
                return data;
              },
            },
          ],
          order: [
            [7, "desc"],
          ],
          ordering: true,
          paging: "numbers",
          pageLength: 8,
          lengthChange: false,
          searching: true,
        });

        dataTable.on('search.dt', updateTotalPlaytime);
        dataTable.on('length.dt', updateTotalPlaytime);

        $("#TotalPlaytime-placeholder")[0].insertAdjacentHTML(
          "beforeend",
          '<div id="TotalPlaytime">Total Playtime\n</div>'
        );

        var filterElement = $("#DataTables_Table_0_filter").detach();
        $("#filter-placeholder").append(filterElement);

        document
          .getElementById("Toggle-Pagination")
          .addEventListener("click", () => {
            if ($("table").DataTable().page.len() == 8) {
              document.getElementById("Toggle-Pagination").innerText =
                "Paginate";
              $("table").DataTable().page.len(-1).draw();
            } else {
              document.getElementById("Toggle-Pagination").innerText =
                "Show All";
              $("table").DataTable().page.len(8).draw();
            }
            updateTotalPlaytime();
          });

        $("#games-table-container").addClass("ready");
        updateTotalPlaytime();
      });
    </script>
  </head>

  <body>
    <div id="header-container">
      <div id="TotalPlaytime-placeholder"></div>
      <h1>All Games</h1>
      <div id="filter-placeholder"></div>
    </div>
    <div id="main-panel">
      <div id="games-table-container">_GAMESTABLE_</div>
      <div id="button-container">
        <button class="custom-button" id="Toggle-Pagination">Show All</button>
      </div>
    </div>
    <div id="navigation-bar">
      <button class="custom-button" id="summary-button" onclick="window.location.href='file:///C:/ProgramData/GamingGaiden/ui/Summary.html';">Life Time Summary</button>
      <button class="custom-button" id="gaming-time-button" onclick="window.location.href='file:///C:/ProgramData/GamingGaiden/ui/GamingTime.html';">Time Spent Gaming</button>
      <button class="custom-button" id="most-played-button" onclick="window.location.href='file:///C:/ProgramData/GamingGaiden/ui/MostPlayed.html';">Most Played</button>
      <button class="custom-button" id="all-games-button" onclick="window.location.href='file:///C:/ProgramData/GamingGaiden/ui/AllGames.html';">All Games</button>
      <button class="custom-button" id="idle-time-button" onclick="window.location.href='file:///C:/ProgramData/GamingGaiden/ui/IdleTime.html';">Idle Time</button>
      <button class="custom-button" id="session-history-button" onclick="window.location.href='file:///C:/ProgramData/GamingGaiden/ui/SessionHistory.html';">Session History</button>
      <button class="custom-button" id="games-per-platform-button" onclick="window.location.href='file:///C:/ProgramData/GamingGaiden/ui/GamesPerPlatform.html';">Games Per Platform</button>
      <button class="custom-button" id="pc-vs-emu-button" onclick="window.location.href='file:///C:/ProgramData/GamingGaiden/ui/PCvsEmulation.html';">PC vs Emulation Time</button>
    </div>
  </body>
</html>
